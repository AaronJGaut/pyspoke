#!/usr/bin/env python
import json
import spoke

import argparse

parser = argparse.ArgumentParser()
parser.add_argument("channel")
parser.add_argument("body", nargs="?", default=None)
parser.add_argument("--persist", "-p", action="store_true")
parser.add_argument("--timeout", "-t", type=float)
args = parser.parse_args()

if args.body is None:
    body = args.body
else:
    body = json.loads(args.body)

spoke.simple.publish(args.channel, body, timeout=args.timeout, persist=args.persist)
