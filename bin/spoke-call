#!/usr/bin/env python
import json
import spoke
import sys

import argparse

parser = argparse.ArgumentParser()
parser.add_argument("channel")
parser.add_argument("payload", nargs="?", default=None)
parser.add_argument("-t", "--timeout", type=float, default=None)
args = parser.parse_args()

if args.payload is None:
    payload = args.payload
else:
    payload = json.loads(args.payload)

try:
    print(spoke.simple.call(args.channel, payload, timeout=args.timeout))
except TimeoutError:
    print("Timeout")
    sys.exit(1)
except spoke.pubsub.error.RemoteCallError as e:
    msg = "Error: {}"
    print(msg.format(e))
    sys.exit(1)
